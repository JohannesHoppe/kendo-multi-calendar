language: node_js

matrix:
  fast_finish: true
  include:
    - env: TEST='minimal'
      node_js: '7'
    - env: TEST='normal'
      node_js: '7'
  allow_failures:
    - env: TEST='normal'

addons:
  sauce_connect:
    username: 'iyegoroff-5'
    no_ssl_bump_domains: all
  jwt:
    secure: >
      uvgMIV9pV34IxL6/AZTajEW9fBz0KeO6Sht1x5NAb34AO70Aaw9g5cjk9FiaH5bP0dEY5YDKSiPvT9plBs36djdmoOjv87OGMpg/IitZk9MSwTuIS
      q+eLooQdEcFlTLxdTgeZ0xunQ516Y5M4j4idFiOxiMHmRbqOFjKnVjr/inhobmIbk+dZVbpnjXd+Qu1CLvJm1Mgd++4rugJBlQ6lzbfIHA77AJG5I
      fGnurQKOqxsISoNmEPYeZeK96ylfm7rwpxzIjWWC5CaVltJnMzP4XOieTjK3ycIpqv2VGshT2z26smnycm99RVj/SGQuDHfx870GBx2xNw11GNclR
      9FqrA8abYmOsMgX2c6rHzQIgBB3YC24SBxwVx1Qnp4uv+OZlqwFun/6kncFJhgb54A4g/KaiTRHA8aalwYQiU8XoSJlu++uwJoMVDflDG0NAWbVw8
      a0OPbZhujXFx+Bebg6j3RboPfzyvTvFobHVvNOBkyV7bRzGDx0PkBAIydeyWDgS7LILSrX5zfWD1xck+FCM/LUyeAI6PFmfjEz8hsl9V/kcQ86h9O
      nHPYvh0ssIZV8vMmSCpnpl6NxabeUp7s8wa/5Ns2Erh1ptI2mi/fhhkuwgWWbMdxDNx9cdtYuLZNCaphb8MAHTVErvOlVUOdkwgCLskfxQHTlAZMl
      odo7Y=

branches:
  only:
    - master
    - /^v\d+\.\d+\.\d+$/

before_deploy:
  cp ./dist/kendo-multi-calendar.min.js ./public/kendo-multi-calendar.min.js

deploy:
  - provider: npm
    email: iegoroff@gmail.com
    api_key:
      secure: >
        Ws0lVPKRNnSeiBf2XAjqGJOqhTaMfZf4Fjc9UdwQTAM7z+z1RpBqf5nTCQPIqu9x3cspP6CQPzArzMQ8hEHdFfUzTNQrqIiO6m/KxbX48Or4zXv
        2zwDhhr30EjdH56af68J+NogwrQsjDqKDBSwMSYYfuSBw4gzMGn8KH73Km83eW6fNuop3vd+Mej2uUxWg3V6XjmbEfXFponVTEkV1X43XXEBc2N
        dbBtnfFAyKRXH1mHQF/e/1pRNWDgOfObvqypzpvBoZJGBBOeRikYpv986D1juMWTHDTOxin724OP5i0HbuoF3BtmjURBnovOfMUASqp/IpH39cn
        TxqoMnjbQuh7znZAC7Zie9EswVo9JAluDS0thqYCZzaSfUdtgZN26xayBcAADrJ7QwrJnABG/d8XlawS7i7vtwhfVQtYOGHD9I/MSgqsDqDAFv7
        y/nbAbtLGrxsD3lFDQtQGua4ZQU8Dzuya7mDjQTnK+8U0jm7DSBiAq5Q5VGzY5mHHpA7+G4uNzzFRHBMonf76Px19pvZqlMiKqTE6fRTFlWt32d
        onAtGm73B9EhBQPTe39qWMjipGjFqRZiVCNBwPKo3TDlyCJbRFCPkhEsRW+BvdJo5aizDSQhtKt+JcfC2ZOhuAH6CR8TJACVmS6h/frNPV1vNw+
        1/ZzFhZfB7RwV0TLc=
    skip_cleanup: true
    on:
      tags: true
      condition: $TEST == 'minimal'
  - provider: surge
    project: ./public/
    domain: kendo-multi-calendar.surge.sh  
    skip_cleanup: true
    on:
      tags: true
      condition: $TEST == 'minimal'

before_script:
  npm run build

script:
  - if [[ $TEST == 'minimal' ]]; then npm run lint && npm run test:ci:minimal; fi
  - if [[ $TEST == 'normal' ]]; then npm run test:ci:normal; fi
after_script:
  if [[ $TEST == 'minimal' ]]; then npm run coverage; fi
